<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Yezzi Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Nice paper collection, computer tech records, and personal thoughts">
<meta property="og:type" content="website">
<meta property="og:title" content="Yezzi Tech">
<meta property="og:url" content="https://yezzi.tech/index.html">
<meta property="og:site_name" content="Yezzi Tech">
<meta property="og:description" content="Nice paper collection, computer tech records, and personal thoughts">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Mingzhe Liu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Yezzi Tech" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  
<link rel="stylesheet" href="/css/styles.css">

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class="active"
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Yezzi Tech</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          
  
    <article id="post-问题" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E9%97%AE%E9%A2%98/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E9%97%AE%E9%A2%98/" class="article-date"><time datetime="2021-07-02T11:06:38.805Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>list.Filter函数把哪些不可以升级的交易过滤了；</p>
<p>哪些节点维护交易池；</p>
<p>交易池的定义抽象地起到什么作用，节点维护交易池的动机；</p>
<p>几个维度交易的排序，除了price，是否还有time时间戳的先后；</p>
<p>新块来了之后如果出现分叉，如何操作交易池的现在的区块链接口和交易池的升降级；</p>
<p>reset操作再详细看些;</p>
<p>虚拟机存储与stateDB状态树等等有关系，增加讨论</p>
<hr>
<p>一些反思：跟看的这些数据结构有关的走的流程；</p>
<p>一些编码细节；</p>
<p>工程师角度的流程分析，试着用自己的语言描述代码构成；</p>
<p>读代码的思路：宏观和具体，理论和解释；</p>
<p>在代码中写好注释</p>
<hr>
<p>交易树的构建细节；</p>
<p>交易池的构建；</p>
<p>涉及到交易、收据、区块的流程分析；</p>
<p>rlp、hex、hp编码；</p>
<p>收据树具体，和布隆过滤器具体，智能合约的event是不是就写入日志的；</p>
<p>secure trie的作用；</p>
<p>回执不在区块中在哪里；</p>
<p>statedb具体为何用pending\dirty状态；</p>
<hr>
<p>宏观过程：确定一个topic/address如何确定在哪个区块的哪个收据的哪个log里，整个过程是怎样的<br>区块链到底是什么不可篡改<br>别的节点怎么验证的<br>和智能合约相关的</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E9%97%AE%E9%A2%98/" data-id="ckqma5nsf001c0wu74y83380v" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-状态；状态树代码分析" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E7%8A%B6%E6%80%81%EF%BC%9B%E7%8A%B6%E6%80%81%E6%A0%91%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E7%8A%B6%E6%80%81%EF%BC%9B%E7%8A%B6%E6%80%81%E6%A0%91%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" class="article-date"><time datetime="2021-07-02T11:06:38.804Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>/core/state：状态树相关文件。对其中几个重要类型和函数解析。</p>
<p>database.go：封装数据库访问的方法</p>
<p>定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Database <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// OpenTrie opens the main account trie.</span></span><br><span class="line">	OpenTrie(root common.Hash) (Trie, error)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// OpenStorageTrie opens the storage trie of an account.</span></span><br><span class="line">	OpenStorageTrie(addrHash, root common.Hash) (Trie, error)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CopyTrie returns an independent copy of the given trie.</span></span><br><span class="line">	CopyTrie(Trie) Trie</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ContractCode retrieves a particular contract&#x27;s code.</span></span><br><span class="line">	ContractCode(addrHash, codeHash common.Hash) ([]<span class="keyword">byte</span>, error)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ContractCodeSize retrieves a particular contracts code&#x27;s size.</span></span><br><span class="line">	ContractCodeSize(addrHash, codeHash common.Hash) (<span class="keyword">int</span>, error)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// TrieDB retrieves the low level trie database used for data storage.</span></span><br><span class="line">	TrieDB() *trie.Database</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDatabase</span><span class="params">(db ethdb.Database)</span> <span class="title">Database</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewDatabaseWithCache(db, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewDatabaseWithCache creates a backing store for state. The returned database</span></span><br><span class="line"><span class="comment">// is safe for concurrent use and retains a lot of collapsed RLP trie nodes in a</span></span><br><span class="line"><span class="comment">// large memory cache.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDatabaseWithCache</span><span class="params">(db ethdb.Database, cache <span class="keyword">int</span>)</span> <span class="title">Database</span></span> &#123;</span><br><span class="line">	csc, _ := lru.New(codeSizeCacheSize)</span><br><span class="line">	<span class="keyword">return</span> &amp;cachingDB&#123;</span><br><span class="line">		db:            trie.NewDatabaseWithCache(db, cache),</span><br><span class="line">		codeSizeCache: csc,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新建数据库对象返回的其实是trie.database类型+codeSizeCache</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// OpenTrie opens the main account trie at a specific root hash.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *cachingDB)</span> <span class="title">OpenTrie</span><span class="params">(root common.Hash)</span> <span class="params">(Trie, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> trie.NewSecure(root, db.db)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用底层的trie包中的方法，对secure的说明如下：SecureTrie使用密钥散列来包装trie。在安全trie中，所有访问操作都使用keccak256散列密钥。这可以防止调用代码创建增加访问时间的长节点链。</span></span><br><span class="line"><span class="comment">//与常规trie相反，SecureTrie只能用New创建，并且必须有附加的数据库。数据库还存储每个密钥的预映像。</span></span><br><span class="line"><span class="comment">//SecureTrie对于并发使用是不安全的。</span></span><br></pre></td></tr></table></figure>

<p>state_object.go：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stateObject表示正在修改的以太坊帐户。</span></span><br><span class="line"><span class="comment">//使用模式如下：首先需要获得一个state对象。通过对象访问和修改帐户值。最后，调用CommitTrie将修改后的存储trie写入数据库。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stateObject的定义如下：</span></span><br><span class="line"><span class="keyword">type</span> stateObject <span class="keyword">struct</span> &#123;</span><br><span class="line">	address  common.Address</span><br><span class="line">	addrHash common.Hash <span class="comment">// hash of ethereum address of the account</span></span><br><span class="line">	data     Account</span><br><span class="line">	db       *StateDB</span><br><span class="line"></span><br><span class="line">	<span class="comment">// DB error.</span></span><br><span class="line">	<span class="comment">// State objects are used by the consensus core and VM which are</span></span><br><span class="line">	<span class="comment">// unable to deal with database-level errors. Any error that occurs</span></span><br><span class="line">	<span class="comment">// during a database read is memoized here and will eventually be returned</span></span><br><span class="line">	<span class="comment">// by StateDB.Commit.</span></span><br><span class="line">	dbErr error</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Write caches.</span></span><br><span class="line">	trie Trie <span class="comment">// storage trie, which becomes non-nil on first access这个trie是智能合约的那个storagetree</span></span><br><span class="line">	code Code <span class="comment">// contract bytecode, which gets set when code is loaded</span></span><br><span class="line"></span><br><span class="line">	originStorage  Storage <span class="comment">// Storage cache of original entries to dedup rewrites, reset for every transaction对原始项的存储缓存进行重复数据消除重写，为每个事务重置</span></span><br><span class="line">	pendingStorage Storage <span class="comment">// Storage entries that need to be flushed to disk, at the end of an entire block</span></span><br><span class="line">	dirtyStorage   Storage <span class="comment">// Storage entries that have been modified in the current transaction execution</span></span><br><span class="line">	fakeStorage    Storage <span class="comment">// Fake storage which constructed by caller for debugging purpose.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Cache flags.</span></span><br><span class="line">	<span class="comment">// When an object is marked suicided it will be delete from the trie</span></span><br><span class="line">	<span class="comment">// during the &quot;update&quot; phase of the state transition.</span></span><br><span class="line">	dirtyCode <span class="keyword">bool</span> <span class="comment">// true if the code was updated</span></span><br><span class="line">	suicided  <span class="keyword">bool</span></span><br><span class="line">	deleted   <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newObject</span><span class="params">(db *StateDB, address common.Address, data Account)</span> *<span class="title">stateObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">getTrie</span><span class="params">(db Database)</span> <span class="title">Trie</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Storage <span class="keyword">map</span>[common.Hash]common.Hash</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetState updates a value in account storage.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">SetState</span><span class="params">(db Database, key, value common.Hash)</span></span> &#123;</span><br><span class="line">	<span class="comment">// If the fake storage is set, put the temporary state update here.</span></span><br><span class="line">	<span class="keyword">if</span> s.fakeStorage != <span class="literal">nil</span> &#123;</span><br><span class="line">		s.fakeStorage[key] = value<span class="comment">//用于调试，如果fakeStorage不是空，则优先把用于调试的storage设为value</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// If the new value is the same as old, don&#x27;t set</span></span><br><span class="line">	prev := s.GetState(db, key)</span><br><span class="line">	<span class="keyword">if</span> prev == value &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// New value is different, update and journal the change</span></span><br><span class="line">	s.db.journal.<span class="built_in">append</span>(storageChange&#123;</span><br><span class="line">		account:  &amp;s.address,</span><br><span class="line">		key:      key,</span><br><span class="line">		prevalue: prev,</span><br><span class="line">	&#125;)</span><br><span class="line">	s.setState(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">setState</span><span class="params">(key, value common.Hash)</span></span> &#123;</span><br><span class="line">	s.dirtyStorage[key] = value<span class="comment">//已修改的存储项</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// finalise moves all dirty storage slots into the pending area to be hashed or</span></span><br><span class="line"><span class="comment">// committed later. It is *invoked at the end of every transaction*.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">finalise</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> key, value := <span class="keyword">range</span> s.dirtyStorage &#123;</span><br><span class="line">		s.pendingStorage[key] = value<span class="comment">//在整个块的末尾，需要刷新到磁盘的存储项</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s.dirtyStorage) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		s.dirtyStorage = <span class="built_in">make</span>(Storage)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//updateTrie writes cached storage modifications into the object&#x27;s storage trie.</span></span><br><span class="line"><span class="comment">//It will return nil if the trie has not been loaded and no changes have been made</span></span><br><span class="line"><span class="comment">//updaterie将缓存的存储修改写入对象的存储trie。</span></span><br><span class="line"><span class="comment">//如果未加载trie且未做任何更改，则返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">updateTrie</span><span class="params">(db Database)</span> <span class="title">Trie</span></span> &#123;</span><br><span class="line">	<span class="comment">// Make sure all dirty slots are finalized into the pending storage area</span></span><br><span class="line">	s.finalise()</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s.pendingStorage) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.trie</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Track the amount of time wasted on updating the storge trie</span></span><br><span class="line">	<span class="keyword">if</span> metrics.EnabledExpensive &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(start time.Time)</span></span> &#123; s.db.StorageUpdates += time.Since(start) &#125;(time.Now())</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Insert all the pending updates into the trie</span></span><br><span class="line">	tr := s.getTrie(db)</span><br><span class="line">	<span class="keyword">for</span> key, value := <span class="keyword">range</span> s.pendingStorage &#123;</span><br><span class="line">		<span class="comment">// Skip noop changes, persist actual changes</span></span><br><span class="line">		<span class="keyword">if</span> value == s.originStorage[key] &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		s.originStorage[key] = value</span><br><span class="line"><span class="comment">//对原始项的存储缓存进行重复数据消除重写</span></span><br><span class="line">		<span class="keyword">if</span> (value == common.Hash&#123;&#125;) &#123;</span><br><span class="line">			s.setError(tr.TryDelete(key[:]))</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Encoding []byte cannot fail, ok to ignore the error.</span></span><br><span class="line">		v, _ := rlp.EncodeToBytes(common.TrimLeftZeroes(value[:]))</span><br><span class="line">		s.setError(tr.TryUpdate(key[:], v))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s.pendingStorage) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		s.pendingStorage = <span class="built_in">make</span>(Storage)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommitTrie the storage trie of the object to db.</span></span><br><span class="line"><span class="comment">// This updates the trie root.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stateObject)</span> <span class="title">CommitTrie</span><span class="params">(db Database)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="comment">// If nothing changed, don&#x27;t bother with hashing anything</span></span><br><span class="line">	<span class="keyword">if</span> s.updateTrie(db) == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> s.dbErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.dbErr</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Track the amount of time wasted on committing the storge trie</span></span><br><span class="line">	<span class="keyword">if</span> metrics.EnabledExpensive &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(start time.Time)</span></span> &#123; s.db.StorageCommits += time.Since(start) &#125;(time.Now())</span><br><span class="line">	&#125;</span><br><span class="line">	root, err := s.trie.Commit(<span class="literal">nil</span>)</span><br><span class="line">    <span class="comment">// Commit writes all nodes to the trie&#x27;s memory database, tracking the internal</span></span><br><span class="line">	<span class="comment">// and external (for account tries) references.</span></span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		s.data.Root = root</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>statedb.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//StateDBs within the ethereum protocol are used to store anything</span></span><br><span class="line"><span class="comment">//within the merkle trie. StateDBs take care of caching and storing</span></span><br><span class="line"><span class="comment">//nested states. It&#x27;s the general query interface to retrieve:</span></span><br><span class="line"><span class="comment">//* Contracts</span></span><br><span class="line"><span class="comment">//* Accounts</span></span><br><span class="line"><span class="keyword">type</span> StateDB <span class="keyword">struct</span> &#123;</span><br><span class="line">	db   Database</span><br><span class="line">	trie Trie</span><br><span class="line"></span><br><span class="line">	<span class="comment">// This map holds &#x27;live&#x27; objects, which will get modified while processing a state transition.</span></span><br><span class="line">	stateObjects        <span class="keyword">map</span>[common.Address]*stateObject</span><br><span class="line">	stateObjectsPending <span class="keyword">map</span>[common.Address]<span class="keyword">struct</span>&#123;&#125; <span class="comment">// State objects finalized but not yet written to the trie</span></span><br><span class="line">	stateObjectsDirty   <span class="keyword">map</span>[common.Address]<span class="keyword">struct</span>&#123;&#125; <span class="comment">// State objects modified in the current execution</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DB error.</span></span><br><span class="line">	<span class="comment">// State objects are used by the consensus core and VM which are</span></span><br><span class="line">	<span class="comment">// unable to deal with database-level errors. Any error that occurs</span></span><br><span class="line">	<span class="comment">// during a database read is memoized here and will eventually be returned</span></span><br><span class="line">	<span class="comment">// by StateDB.Commit.</span></span><br><span class="line">	dbErr error</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The refund counter, also used by state transitioning.</span></span><br><span class="line">	refund <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line">	thash, bhash common.Hash</span><br><span class="line">	txIndex      <span class="keyword">int</span></span><br><span class="line">	logs         <span class="keyword">map</span>[common.Hash][]*types.Log</span><br><span class="line">	logSize      <span class="keyword">uint</span></span><br><span class="line"></span><br><span class="line">	preimages <span class="keyword">map</span>[common.Hash][]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Journal of state modifications. This is the backbone of</span></span><br><span class="line">	<span class="comment">// Snapshot and RevertToSnapshot.</span></span><br><span class="line">	journal        *journal</span><br><span class="line">	validRevisions []revision</span><br><span class="line">	nextRevisionId <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Measurements gathered during execution for debugging purposes</span></span><br><span class="line">	AccountReads   time.Duration</span><br><span class="line">	AccountHashes  time.Duration</span><br><span class="line">	AccountUpdates time.Duration</span><br><span class="line">	AccountCommits time.Duration</span><br><span class="line">	StorageReads   time.Duration</span><br><span class="line">	StorageHashes  time.Duration</span><br><span class="line">	StorageUpdates time.Duration</span><br><span class="line">	StorageCommits time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StateDB)</span> <span class="title">updateStateObject</span><span class="params">(obj *stateObject)</span></span> &#123;</span><br><span class="line">	<span class="comment">// Track the amount of time wasted on updating the account from the trie</span></span><br><span class="line">	<span class="keyword">if</span> metrics.EnabledExpensive &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(start time.Time)</span></span> &#123; s.AccountUpdates += time.Since(start) &#125;(time.Now())</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Encode the account and update the account trie</span></span><br><span class="line">	addr := obj.Address()</span><br><span class="line"></span><br><span class="line">	data, err := rlp.EncodeToBytes(obj)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;can&#x27;t encode object at %x: %v&quot;</span>, addr[:], err))</span><br><span class="line">	&#125;</span><br><span class="line">	s.setError(s.trie.TryUpdate(addr[:], data))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StateDB)</span> <span class="title">getStateObject</span><span class="params">(addr common.Address)</span> *<span class="title">stateObject</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> obj := s.getDeletedStateObject(addr); obj != <span class="literal">nil</span> &amp;&amp; !obj.deleted &#123;</span><br><span class="line">		<span class="keyword">return</span> obj</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAccount explicitly creates a state object. If a state object with the address</span></span><br><span class="line"><span class="comment">// already exists the balance is carried over to the new account.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StateDB)</span> <span class="title">createObject</span><span class="params">(addr common.Address)</span> <span class="params">(newobj, prev *stateObject)</span></span> &#123;</span><br><span class="line">	prev = s.getDeletedStateObject(addr) <span class="comment">// Note, prev might have been deleted, we need that!</span></span><br><span class="line"></span><br><span class="line">	newobj = newObject(s, addr, Account&#123;&#125;)</span><br><span class="line">	newobj.setNonce(<span class="number">0</span>) <span class="comment">// sets the object to dirty</span></span><br><span class="line">	<span class="keyword">if</span> prev == <span class="literal">nil</span> &#123;</span><br><span class="line">		s.journal.<span class="built_in">append</span>(createObjectChange&#123;account: &amp;addr&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		s.journal.<span class="built_in">append</span>(resetObjectChange&#123;prev: prev&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	s.setStateObject(newobj)</span><br><span class="line">	<span class="keyword">return</span> newobj, prev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Commit writes the state to the underlying in-memory trie database.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StateDB)</span> <span class="title">Commit</span><span class="params">(deleteEmptyObjects <span class="keyword">bool</span>)</span> <span class="params">(common.Hash, error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// Finalize any pending changes and merge everything into the tries</span></span><br><span class="line">	s.IntermediateRoot(deleteEmptyObjects)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Commit objects to the trie, measuring the elapsed time</span></span><br><span class="line">	<span class="keyword">for</span> addr := <span class="keyword">range</span> s.stateObjectsDirty &#123;</span><br><span class="line">		<span class="keyword">if</span> obj := s.stateObjects[addr]; !obj.deleted &#123;</span><br><span class="line">			<span class="comment">// Write any contract code associated with the state object</span></span><br><span class="line">			<span class="keyword">if</span> obj.code != <span class="literal">nil</span> &amp;&amp; obj.dirtyCode &#123;</span><br><span class="line">				s.db.TrieDB().InsertBlob(common.BytesToHash(obj.CodeHash()), obj.code)</span><br><span class="line">				obj.dirtyCode = <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Write any storage changes in the state object to its storage trie</span></span><br><span class="line">			<span class="keyword">if</span> err := obj.CommitTrie(s.db); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> common.Hash&#123;&#125;, err</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s.stateObjectsDirty) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		s.stateObjectsDirty = <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Write the account trie changes, measuing the amount of wasted time</span></span><br><span class="line">	<span class="keyword">if</span> metrics.EnabledExpensive &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(start time.Time)</span></span> &#123; s.AccountCommits += time.Since(start) &#125;(time.Now())</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// The onleaf func is called _serially_, so we can reuse the same account</span></span><br><span class="line">	<span class="comment">// for unmarshalling every time.</span></span><br><span class="line">	<span class="keyword">var</span> account Account</span><br><span class="line">	<span class="keyword">return</span> s.trie.Commit(<span class="function"><span class="keyword">func</span><span class="params">(leaf []<span class="keyword">byte</span>, parent common.Hash)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := rlp.DecodeBytes(leaf, &amp;account); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> account.Root != emptyRoot &#123;</span><br><span class="line">			s.db.TrieDB().Reference(account.Root, parent)</span><br><span class="line">		&#125;</span><br><span class="line">		code := common.BytesToHash(account.CodeHash)</span><br><span class="line">		<span class="keyword">if</span> code != emptyCode &#123;</span><br><span class="line">			s.db.TrieDB().Reference(code, parent)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E7%8A%B6%E6%80%81%EF%BC%9B%E7%8A%B6%E6%80%81%E6%A0%91%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" data-id="ckqma5nsc001b0wu7hh8u4i8w" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-后端文档" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/" class="article-date"><time datetime="2021-07-02T11:06:38.803Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="yezzi-browser1-0-文档"><a href="#yezzi-browser1-0-文档" class="headerlink" title="yezzi_browser1.0 文档"></a>yezzi_browser1.0 文档</h1><h2 id="一、产品简介"><a href="#一、产品简介" class="headerlink" title="一、产品简介"></a>一、产品简介</h2><h4 id="1-1-基本描述"><a href="#1-1-基本描述" class="headerlink" title="1.1 基本描述"></a>1.1 基本描述</h4><h6 id="yezzi-browser在fisco-bcos-browser基础上进行修改，和fisco-bcos-browser一样适配FISCO-BCOS-2-0-版本"><a href="#yezzi-browser在fisco-bcos-browser基础上进行修改，和fisco-bcos-browser一样适配FISCO-BCOS-2-0-版本" class="headerlink" title="yezzi_browser在fisco-bcos-browser基础上进行修改，和fisco-bcos-browser一样适配FISCO BCOS 2.0+版本"></a>yezzi_browser在fisco-bcos-browser基础上进行修改，和fisco-bcos-browser一样适配FISCO BCOS 2.0+版本</h6><p>区块链浏览器将区块链中的数据可视化，并进行实时展示。方便用户以Web页面的方式，获取当前区块链中的信息。而修改后的浏览器主要增加区块链中个性化数据的展示，以满足各种业务需求和区块链中交易的监管。</p>
<h4 id="1-2-主要功能模块"><a href="#1-2-主要功能模块" class="headerlink" title="1.2 主要功能模块"></a>1.2 主要功能模块</h4><p>媒体素材链的主要功能模块有：区块和交易一揽；业务数量统计；各种交易趋势；等等（正在考虑新增其他特性）</p>
<h5 id="1-2-1-区块链信息展示模块"><a href="#1-2-1-区块链信息展示模块" class="headerlink" title="1.2.1 区块链信息展示模块"></a>1.2.1 区块链信息展示模块</h5><p>和原版一样，主要展示了链上群组的具体信息，这些信息包括：概览信息，区块信息，交易信息。</p>
<h5 id="1-2-2-业务数据统计"><a href="#1-2-2-业务数据统计" class="headerlink" title="1.2.2 业务数据统计"></a>1.2.2 业务数据统计</h5><p>包括：上链素材统计；图片交易数量；图片侵权数量；图片确权总数；交易图片增长趋势；确权图片量增长趋势；</p>
<h2 id="二、安装说明"><a href="#二、安装说明" class="headerlink" title="二、安装说明"></a>二、安装说明</h2><h4 id="2-1-群组搭建"><a href="#2-1-群组搭建" class="headerlink" title="2.1 群组搭建"></a>2.1 群组搭建</h4><p>按照<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/installation.html">FISCO BCOS</a>标准的搭建方式搭链即可</p>
<h4 id="2-2-部署说明"><a href="#2-2-部署说明" class="headerlink" title="2.2 部署说明"></a>2.2 部署说明</h4><p>参考<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/browser/browser.html">fisco-bcos-browser文档</a></p>
<h6 id="区别："><a href="#区别：" class="headerlink" title="区别："></a>区别：</h6><h6 id="1-后端搭建步骤中，在gradle-build之前需要改动start-sh-在CLASSPATH一行加入conf-template-目的是在build-gradle中重写的jar命令中将resources中文件复制到conf-template中而没放到conf中，即使编译过，因为log4j2-xml缺失，运行dist中复制后的start-sh时会出现找不到该文件而报错，无法运行。需要注意的是，必须在编译Jar包之前修改start-sh文件，在dist目录存在时，gradle-build命令不会再对dist中的内容进行修改，即使里面缺少东西也不会按照gradle里面写的步骤进行下去。"><a href="#1-后端搭建步骤中，在gradle-build之前需要改动start-sh-在CLASSPATH一行加入conf-template-目的是在build-gradle中重写的jar命令中将resources中文件复制到conf-template中而没放到conf中，即使编译过，因为log4j2-xml缺失，运行dist中复制后的start-sh时会出现找不到该文件而报错，无法运行。需要注意的是，必须在编译Jar包之前修改start-sh文件，在dist目录存在时，gradle-build命令不会再对dist中的内容进行修改，即使里面缺少东西也不会按照gradle里面写的步骤进行下去。" class="headerlink" title="1.后端搭建步骤中，在gradle build之前需要改动start.sh,在CLASSPATH一行加入conf_template/: 目的是在build.gradle中重写的jar命令中将resources中文件复制到conf_template中而没放到conf中，即使编译过，因为log4j2.xml缺失，运行dist中复制后的start.sh时会出现找不到该文件而报错，无法运行。需要注意的是，必须在编译Jar包之前修改start.sh文件，在dist目录存在时，gradle build命令不会再对dist中的内容进行修改，即使里面缺少东西也不会按照gradle里面写的步骤进行下去。"></a>1.后端搭建步骤中，在gradle build之前需要改动start.sh,在CLASSPATH一行加入conf_template/: 目的是在build.gradle中重写的jar命令中将resources中文件复制到conf_template中而没放到conf中，即使编译过，因为log4j2.xml缺失，运行dist中复制后的start.sh时会出现找不到该文件而报错，无法运行。需要注意的是，必须在编译Jar包之前修改start.sh文件，在dist目录存在时，gradle build命令不会再对dist中的内容进行修改，即使里面缺少东西也不会按照gradle里面写的步骤进行下去。</h6><h6 id="2-运行前根目录下若有dist文件夹，先运行gradle-clean-再重新gradle-build"><a href="#2-运行前根目录下若有dist文件夹，先运行gradle-clean-再重新gradle-build" class="headerlink" title="2.运行前根目录下若有dist文件夹，先运行gradle clean 再重新gradle build"></a>2.运行前根目录下若有dist文件夹，先运行gradle clean 再重新gradle build</h6><h4 id="2-3-问题排查"><a href="#2-3-问题排查" class="headerlink" title="2.3 问题排查"></a>2.3 问题排查</h4><h5 id="2-3-1-主机无法复制文件和文字到虚拟机"><a href="#2-3-1-主机无法复制文件和文字到虚拟机" class="headerlink" title="2.3.1 主机无法复制文件和文字到虚拟机"></a>2.3.1 主机无法复制文件和文字到虚拟机</h5><p>解决方法1：安装vmware tools,并在设置中勾选上允许客户端和虚拟机。</p>
<p>解决方法2：在插入u盘的时候虚拟机会提示是否连接虚拟机，选是，后面按提示走就可以把u盘文件复制过去</p>
<h5 id="2-3-2-安装vmware-tools的选项显示灰色的解决方法"><a href="#2-3-2-安装vmware-tools的选项显示灰色的解决方法" class="headerlink" title="2.3.2 安装vmware tools的选项显示灰色的解决方法"></a>2.3.2 安装vmware tools的选项显示灰色的解决方法</h5><p>在虚拟机设置-硬件-   CD/DVD   CD/DVD2   软盘   中都勾选住使用物理驱动器-自动检测，之后重启即可</p>
<h5 id="2-3-3-mysql-root密码忘记怎么办？"><a href="#2-3-3-mysql-root密码忘记怎么办？" class="headerlink" title="2.3.3 mysql root密码忘记怎么办？"></a>2.3.3 mysql root密码忘记怎么办？</h5><p>1.关闭Mysql所有服务</p>
<p>2.修改mysql的登录设置,一般在 /etc/my.cnf中，在mysqld段中加上一句skip-grant-tables</p>
<p>3.重启mysql</p>
<p>4.使用数据库mysql : use mysql;</p>
<p>5.改root密码(123456) update user set password = password(‘123456’) where user = ‘root’;</p>
<p>有的版本的Mysql需要用 update user set authentication_string = password(‘123456’) where user = ‘root’;</p>
<p>6.将mysql登录设置改回来</p>
<p>7.重启mysql</p>
<h5 id="2-3-4-连接mysql时出现-can-not-connect-to-local-mysql-through-socket"><a href="#2-3-4-连接mysql时出现-can-not-connect-to-local-mysql-through-socket" class="headerlink" title="2.3.4 连接mysql时出现 can not connect to local mysql through socket"></a>2.3.4 连接mysql时出现 can not connect to local mysql through socket</h5><p>可能的解决方法1：service mysqld start</p>
<p>可能的解决方法2：完善mysql配置文件，/etc/my.cnf中添加[client]和[mysqld]选项，并且使这两个选项下的socket和default的参数值和[mysqld]中的一样</p>
<h5 id="2-3-5-gradle项目编译时出现-could-not-find-method-annotationProcessor-for-arguments"><a href="#2-3-5-gradle项目编译时出现-could-not-find-method-annotationProcessor-for-arguments" class="headerlink" title="2.3.5 gradle项目编译时出现 could not find method annotationProcessor() for arguments"></a>2.3.5 gradle项目编译时出现 could not find method annotationProcessor() for arguments</h5><p>多半是gradle的问题，重新配置下gradle试试</p>
<h5 id="2-3-6-使用数据库时出现OperationError-1698-”Access-denied-for-user-”"><a href="#2-3-6-使用数据库时出现OperationError-1698-”Access-denied-for-user-”" class="headerlink" title="2.3.6 使用数据库时出现OperationError:(1698,”Access denied for user ***”)"></a>2.3.6 使用数据库时出现OperationError:(1698,”Access denied for user ***”)</h5><p>数据库密码错了，看下配置文件或登陆下试试</p>
<h5 id="2-3-7-安装Mysql-python时出现问题：-usr-bin-ld-cannot-find-lssl"><a href="#2-3-7-安装Mysql-python时出现问题：-usr-bin-ld-cannot-find-lssl" class="headerlink" title="2.3.7 安装Mysql-python时出现问题：/usr/bin/ld: cannot find -lssl"></a>2.3.7 安装Mysql-python时出现问题：/usr/bin/ld: cannot find -lssl</h5><p>一般是血少链接库文件 使用 apt-get install lib***-dev</p>
<h5 id="2-3-8-有python2-X的环境却没有pip？"><a href="#2-3-8-有python2-X的环境却没有pip？" class="headerlink" title="2.3.8 有python2.X的环境却没有pip？"></a>2.3.8 有python2.X的环境却没有pip？</h5><p>配置apt源，重新下载python和pyhon-pip</p>
<h1 id="三、技术文档"><a href="#三、技术文档" class="headerlink" title="三、技术文档"></a>三、技术文档</h1><h4 id="3-1-后端文件目录"><a href="#3-1-后端文件目录" class="headerlink" title="3.1 后端文件目录"></a>3.1 后端文件目录</h4><p>.gradle：gradle缓存</p>
<p>.idea：idea缓存 </p>
<p>（dist）：编译后产生的目录</p>
<p>gradle：Gradle可以在没有安装Gradle的情况下使用，这时候就需要Gradle Wrapper了。Gradle Wrapper其实就是一个脚本文件，它会在没有安装Gradle的情况下为我们下载Gradle，之后我们就可以使用gradlew命令，像使用gradle一样来使用Gradle了。</p>
<p>log：若从idea直接启动项目，日志文件将产生在这里</p>
<p>src：项目文件</p>
<p>temp：临时文件</p>
<p>build.gradle：gradle是基于jvm的构建工具，build.gradle主要配置软件版本信息、引用库的配置，以及编译所需的配置</p>
<p>gradlew   gradlew.bat   :   linux和windows下运行gradlew命令使用的脚本</p>
<p>start.sh   stop.sh   status.sh   :   运行和停止脚本，会在项目编译后复制到dist目录中，项目就由其控制运行和停止</p>
<h4 id="3-2-后端项目解析"><a href="#3-2-后端项目解析" class="headerlink" title="3.2 后端项目解析"></a>3.2 后端项目解析</h4><h5 id="3-2-1-主要逻辑"><a href="#3-2-1-主要逻辑" class="headerlink" title="3.2.1 主要逻辑"></a>3.2.1 主要逻辑</h5><p><img src="./img/p1.png"></p>
<h5 id="3-2-2-数据同步"><a href="#3-2-2-数据同步" class="headerlink" title="3.2.2 数据同步"></a>3.2.2 数据同步</h5><p><img src="./img/p2.png"></p>
<h5 id="3-2-3-涉及到的注解"><a href="#3-2-3-涉及到的注解" class="headerlink" title="3.2.3 涉及到的注解"></a>3.2.3 涉及到的注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@MapperScan</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@GetMapping</span>   <span class="meta">@PostMapping</span>   <span class="meta">@PutMapping</span>   <span class="meta">@DeleteMapping</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-涉及到的组件"><a href="#3-2-4-涉及到的组件" class="headerlink" title="3.2.4 涉及到的组件"></a>3.2.4 涉及到的组件</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spring组件：</span><br><span class="line">	<span class="string">&quot;org.springframework:spring-core:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-beans:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-context:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-tx:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-jdbc:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-web:$spring_version&quot;</span></span><br><span class="line">	<span class="string">&quot;org.springframework:spring-webmvc:$spring_version&quot;</span></span><br><span class="line">	</span><br><span class="line">    <span class="string">&quot;org.springframework.boot:spring-boot-starter-web:1.5.9.RELEASE&quot;</span>,</span><br><span class="line">	<span class="string">&quot;org.springframework.boot:spring-boot-autoconfigure:1.5.9.RELEASE&quot;</span>,</span><br><span class="line">	<span class="string">&quot;org.springframework.boot:spring-boot-configuration-processor:1.5.9.RELEASE&quot;</span>,</span><br><span class="line">	<span class="string">&quot;org.springframework.boot:spring-boot-starter-log4j2:1.5.9.RELEASE&quot;</span></span><br><span class="line">mysql组件：</span><br><span class="line">	<span class="string">&#x27;org.mybatis:mybatis:3.2.8&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.1&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;mysql:mysql-connector-java:5.1.30&#x27;</span>,</span><br><span class="line">io组件：</span><br><span class="line">	<span class="string">&#x27;commons-io:commons-io:2.6&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;commons-fileupload:commons-fileupload:1.4&#x27;</span></span><br><span class="line">其他组件：</span><br><span class="line">jsonrpc4j：<span class="number">1.5</span><span class="number">.1</span></span><br><span class="line">fastjson：<span class="number">1.2</span><span class="number">.29</span></span><br><span class="line">lombok:<span class="number">1.18</span><span class="number">.2</span></span><br><span class="line">log4j2</span><br></pre></td></tr></table></figure>

<h5 id="3-2-5-部分代码片段解析"><a href="#3-2-5-部分代码片段解析" class="headerlink" title="3.2.5 部分代码片段解析"></a>3.2.5 部分代码片段解析</h5><h6 id="1-SchedulerConfig-java"><a href="#1-SchedulerConfig-java" class="headerlink" title="1.SchedulerConfig.java"></a>1.SchedulerConfig.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">taskRegistrar.addTriggerTask(() -&gt; schedulerService.handleBlockChainInfo(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronBlockChainInfo())</span><br><span class="line">                        .nextExecutionTime(context));</span><br></pre></td></tr></table></figure>

<p>箭头函数。Lambda表达式的本质只是一个语法糖,由编译器推断并帮你转换包装为常规的代码,因此你可以使用更少的代码来实现同样的功能。</p>
<p>addTriggerTask(task, trigger)   参数是两个函数，前一个参数是要执行的任务，后一个参数是触发条件。() -&gt; schedulerService.handleBlockChainInfo() 是箭头函数，表示无参数传递，返回值为schedulerService.handleBlockChainInfo() 。下一个函数代表传入一个箭头函数：context为参数，nextExecutionTime为返回函数，确定执行周期。</p>
<h6 id="2-简易流程分析（以拿区块链数据为例）"><a href="#2-简易流程分析（以拿区块链数据为例）" class="headerlink" title="2.简易流程分析（以拿区块链数据为例）"></a>2.简易流程分析（以拿区块链数据为例）</h6><p>controller:</p>
<p>注释写上方法名，参数，返回。继承抽象类BaseController(进行一些参数检查和错误处理)。之后规定http get方法，/{groupId}的写法是对应url中的/fisco-bcos-browser/home/blockChainInfo/1中的”1”，将地址中的数字直接拿出来而不需要再用参数。其使用@PathVariable绑定URI模板变量值，请求url中的动态参数。得到请求后直接传给service层的getBlockChainInfo函数并等待返回值。</p>
<p>需要注意的是，返回的值是自定义的BaseResponse类型，而是统一放到response对象的数据。该对象是一个bean由@Data注解修饰的数据域，内含状态码、状态消息、值域。有的服务返回BasePageResponse用于返回分页数据,和BaseResponse区别多了个totalCount值表示有几个值（一般是一个对象组成的list）被返回。这样做的好处是有利于前后端分离开发，更规范前端易解析。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;home&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockChainInfoController</span> <span class="keyword">extends</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BlockChainInfoService blockChainInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getBlockChainInfo.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupId groupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/blockChainInfo/&#123;groupId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse <span class="title">getBlockChainInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;groupId&quot;)</span> <span class="keyword">int</span> groupId)</span> </span>&#123;</span><br><span class="line">        BaseResponse response = blockChainInfoService.getBlockChainInfo(groupId);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service:</p>
<p>新建BaseResponse对象。状态码对应success，之后直接调用mapper的方法调用数据库，将返回值放在response对象的data中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockChainInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BlockChainInfoMapper blockChainInfoMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    NodeMapper nodeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getBlockChainInfo.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupId groupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse <span class="title">getBlockChainInfo</span><span class="params">(<span class="keyword">int</span> groupId)</span> </span>&#123;</span><br><span class="line">        BaseResponse response = <span class="keyword">new</span> BaseResponse(ConstantCode.SUCCESS);</span><br><span class="line">        BlockChainInfo tbBlockChainInfo = blockChainInfoMapper.getBlockChainInfo(groupId);</span><br><span class="line">        response.setData(tbBlockChainInfo);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper:</p>
<p>在/resources/mapper下的xml中用sql语言定义好数据库操作，在mapper文件中定义接口函数，就可以调用数据库了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlockChainInfoMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">BlockChainInfo <span class="title">getBlockChainInfo</span><span class="params">(<span class="meta">@Param(value = &quot;groupId&quot;)</span> <span class="keyword">int</span> groupId)</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;org.bcos.browser.mapper.BlockChainInfoMapper&quot;&gt;</span><br><span class="line">&lt;select id=&quot;getBlockChainInfo&quot; resultType=&quot;org.bcos.browser.entity.dto.BlockChainInfo&quot;&gt;</span><br><span class="line">    select &lt;include refid=&quot;ALL_COLUMN&quot; /&gt;</span><br><span class="line">    from tb_blockChainInfo_#&#123;groupId&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>数据库对应的数据：</p>
<p><img src="./img/p3.png"></p>
<h6 id="3-数据同步流程代码分析"><a href="#3-数据同步流程代码分析" class="headerlink" title="3.数据同步流程代码分析"></a>3.数据同步流程代码分析</h6><p>写好rpc通信工具，以便使用json-rpc api调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Web3jRpc</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    NodeMapper nodeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * rpcRequest.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupId groupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodName rpc method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">rpcRequest</span><span class="params">(<span class="keyword">int</span> groupId, String methodName, Object[] params)</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;Node&gt; nodeList = nodeMapper.getManualNode(groupId);</span><br><span class="line">        <span class="keyword">if</span> (nodeList == <span class="keyword">null</span> || nodeList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;there are not manually added nodes&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> nodeSize = nodeList.size();</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;Integer&gt; indexList = <span class="keyword">new</span> ArrayList&lt;&gt;(nodeSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (indexList.size() == nodeSize) &#123;</span><br><span class="line">                <span class="keyword">return</span> object;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> index = random.nextInt(nodeSize);</span><br><span class="line">            <span class="keyword">if</span> (indexList.contains(index)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Node node = nodeList.get(index);</span><br><span class="line">            indexList.add(index);</span><br><span class="line"></span><br><span class="line">            object = requestNode(methodName, params, node);</span><br><span class="line">            <span class="keyword">if</span> (object == <span class="keyword">null</span> &amp;&amp; indexList.size() &lt; nodeSize) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> object;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * requestNode.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodName rpc method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node info</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">requestNode</span><span class="params">(String methodName, Object[] params, Node node)</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line">        JsonRpcHttpClient client = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        String url = String.format(Constants.RPC_BASE_URI, node.getIp(), node.getRpcPort());</span><br><span class="line">        log.debug(<span class="string">&quot;request url: &#123;&#125;&quot;</span>, url);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = <span class="keyword">new</span> JsonRpcHttpClient(<span class="keyword">new</span> URL(url));</span><br><span class="line">            client.setConnectionTimeoutMillis(<span class="number">5000</span>);</span><br><span class="line">            client.setReadTimeoutMillis(<span class="number">5000</span>);</span><br><span class="line">            object = client.invoke(methodName, params, Object.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;fail request methodName:&#123;&#125; ip:&#123;&#125; rpcPort:&#123;&#125;&quot;</span>, methodName, node.getIp(),</span><br><span class="line">                    node.getRpcPort(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义好自动处理（SchedulerConfig.java）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchedulerConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SchedulerService schedulerService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Constants constants;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt; schedulerService.handleBlockChainInfo(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronBlockChainInfo())</span><br><span class="line">                        .nextExecutionTime(context));</span><br><span class="line"></span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt; schedulerService.handleBlocks(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronBlockInfo())</span><br><span class="line">                        .nextExecutionTime(context));</span><br><span class="line"></span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt; schedulerService.handleTxnByDay(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronTxnByDay())</span><br><span class="line">                        .nextExecutionTime(context));</span><br><span class="line"></span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt; schedulerService.syncNodeInfo(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronAyncNode())</span><br><span class="line">                .nextExecutionTime(context));</span><br><span class="line">        </span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt; schedulerService.checkNodeActive(),</span><br><span class="line">            (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronIfNodeActive())</span><br><span class="line">                        .nextExecutionTime(context));</span><br><span class="line"></span><br><span class="line">        taskRegistrar.addTriggerTask(() -&gt;schedulerService.deleteTxnSchedule(),</span><br><span class="line">                (context) -&gt; <span class="keyword">new</span> CronTrigger(constants.getCronDeleteTxn())</span><br><span class="line">                        .nextExecutionTime(context));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写自动处理的详细内容（ScheduleService.java），还是会调用mapper层来给数据库增加数据，例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * handleBlockChainInfo.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleBlockChainInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Group&gt; list = groupMapper.getGroupList();</span><br><span class="line">    <span class="keyword">for</span> (Group loop : list) &#123;</span><br><span class="line">        Object[] params = <span class="keyword">new</span> Object[] &#123;loop.getGroupId()&#125;;</span><br><span class="line">        <span class="comment">// get block number and txn</span></span><br><span class="line">        BlockNumberAndTxn blockNumberAndTxn = web3jRpc.getTxn(loop.getGroupId());</span><br><span class="line">        <span class="comment">// get txn</span></span><br><span class="line">        <span class="keyword">int</span> pendingTxn = CommonUtils.parseHexStr2Int((String) web3jRpc</span><br><span class="line">                .rpcRequest(loop.getGroupId(), Constants.GET_PENDING_TX_SIZE, params));</span><br><span class="line">        <span class="comment">// get pbftView</span></span><br><span class="line">        <span class="keyword">int</span> pbftView = CommonUtils.parseHexStr2Int((String) web3jRpc</span><br><span class="line">                .rpcRequest(loop.getGroupId(), Constants.GET_PBFT_VIEW, params));</span><br><span class="line"></span><br><span class="line">        BlockChainInfo blockChainInfo = <span class="keyword">new</span> BlockChainInfo();</span><br><span class="line">        blockChainInfo.setGroupId(loop.getGroupId());</span><br><span class="line">        blockChainInfo.setLatestNumber(blockNumberAndTxn.getBlockNumber());</span><br><span class="line">        blockChainInfo.setPbftView(pbftView);</span><br><span class="line">        blockChainInfo.setTxn(blockNumberAndTxn.getTxn());</span><br><span class="line">        blockChainInfo.setPendingTxn(pendingTxn);</span><br><span class="line">        blockChainInfoMapper.add(blockChainInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-6-部分组件整理"><a href="#3-2-6-部分组件整理" class="headerlink" title="3.2.6 部分组件整理"></a>3.2.6 部分组件整理</h5><h6 id="1-mybatis：持久层框架，用于操作mysql数据库"><a href="#1-mybatis：持久层框架，用于操作mysql数据库" class="headerlink" title="1.mybatis：持久层框架，用于操作mysql数据库"></a>1.mybatis：持久层框架，用于操作mysql数据库</h6><p>设置好xml的路径（本项目在resources/mapper）后，每个mapper接口文件对应一个xml，接口中写好方法，在xml中按照mysql语法写逻辑即可。例：TransactionMapper.xml：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;getAmount&quot; parameterType=&quot;java.util.Map&quot; resultType=&quot;INTEGER&quot;&gt;</span><br><span class="line">    SELECT count(1) FROM tb_transaction_#&#123;groupId&#125;</span><br><span class="line">    WHERE 1 = 1</span><br><span class="line">    AND method = #&#123;method&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p> 官方教程：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">mybatis教程链接</a></p>
<h6 id="2-jsonrpc4j：以json方式传输的rpc通讯工具"><a href="#2-jsonrpc4j：以json方式传输的rpc通讯工具" class="headerlink" title="2.jsonrpc4j：以json方式传输的rpc通讯工具"></a>2.jsonrpc4j：以json方式传输的rpc通讯工具</h6><p>JSON-RPC有C，C++，C#，Javascipt，Erlang，Objective-C，Java等多种语言的实现。既可独立使用，又可与spring无缝集合。</p>
<p>区块链，FISCO BCOS会在运行时启动rpc服务端并暴露端口可以通过rpc客户端直接连接并对区块链进行查询等操作，示例：RequestNode对象中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String url = String.format(Constants.RPC_BASE_URI, node.getIp(), node.getRpcPort());</span><br><span class="line">log.debug(<span class="string">&quot;request url: &#123;&#125;&quot;</span>, url);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    client = <span class="keyword">new</span> JsonRpcHttpClient(<span class="keyword">new</span> URL(url));</span><br><span class="line">    client.setConnectionTimeoutMillis(<span class="number">5000</span>);</span><br><span class="line">    client.setReadTimeoutMillis(<span class="number">5000</span>);</span><br><span class="line">    object = client.invoke(methodName, params, Object.class);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;fail request methodName:&#123;&#125; ip:&#123;&#125; rpcPort:&#123;&#125;&quot;</span>, methodName, node.getIp(),</span><br><span class="line">            node.getRpcPort(), ex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照api调用的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SyncInfoFromChain <span class="title">getSyncInfo</span><span class="params">(<span class="keyword">int</span> groupId, Node node)</span> </span>&#123;</span><br><span class="line">    SyncInfoFromChain result = <span class="keyword">null</span>;</span><br><span class="line">    Object[] params = <span class="keyword">new</span> Object[] &#123;groupId&#125;;</span><br><span class="line">    Object object = requestNode(Constants.GET_SYNC_STATUS, params, node);</span><br><span class="line">    <span class="keyword">if</span> (object != <span class="keyword">null</span>) &#123;</span><br><span class="line">        result = CommonUtils.object2JavaBean(object, SyncInfoFromChain.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意api调用时json字段每一个参数都是字符串数组</p>
<p>FISCO BCOS 的<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/api.html">API文档</a></p>
<p>JSON-RPC for Java的<a target="_blank" rel="noopener" href="https://github.com/briandilley/jsonrpc4j">github地址</a></p>
<h6 id="3-springboot：web框架无需多说"><a href="#3-springboot：web框架无需多说" class="headerlink" title="3.springboot：web框架无需多说"></a>3.springboot：web框架无需多说</h6><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/">官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api/">API文档</a></p>
<h6 id="4-fastjson：高效的json解析工具"><a href="#4-fastjson：高效的json解析工具" class="headerlink" title="4.fastjson：高效的json解析工具"></a>4.fastjson：高效的json解析工具</h6><p>github地址：<a href="alibaba/fastjson">alibaba/fastjson</a></p>
<p>gradle引入：<code>compile &#39;com.alibaba:fastjson:1.2.29&#39;</code></p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * getTxn.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> groupId groupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BlockNumberAndTxn <span class="title">getTxn</span><span class="params">(<span class="keyword">int</span> groupId)</span> </span>&#123;</span><br><span class="line">    BlockNumberAndTxn result = <span class="keyword">new</span> BlockNumberAndTxn();</span><br><span class="line">    Object[] params = <span class="keyword">new</span> Object[] &#123;groupId&#125;;</span><br><span class="line">    Object object = rpcRequest(groupId, Constants.GET_TOTAL_TRANSACTION_COUNT, params);</span><br><span class="line">    <span class="keyword">if</span> (object != <span class="keyword">null</span>) &#123;</span><br><span class="line">        JSONObject json = JSONObject.parseObject(JSON.toJSONString(object));</span><br><span class="line">        result.setBlockNumber(CommonUtils.parseHexStr2Int(json.getString(<span class="string">&quot;blockNumber&quot;</span>)));</span><br><span class="line">        result.setTxn(CommonUtils.parseHexStr2Int(json.getString(<span class="string">&quot;txSum&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-7-部分注解整理"><a href="#3-2-7-部分注解整理" class="headerlink" title="3.2.7 部分注解整理"></a>3.2.7 部分注解整理</h5>
      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/" data-id="ckqma5nsj001h0wu739sz3ul3" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-区块链浏览器后端说明" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%90%8E%E7%AB%AF%E8%AF%B4%E6%98%8E/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%90%8E%E7%AB%AF%E8%AF%B4%E6%98%8E/" class="article-date"><time datetime="2021-07-02T11:06:38.799Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>区块链浏览器后端说明</p>
<p>运行环境：java, mysql, Fisco-bcos,  python  </p>
<p>新增接口说明:   见接口文档</p>
<p>项目架构：见项目架构</p>
<p>运行：</p>
<p>使用脚本一键运行：python deploy.py startAll</p>
<p>分开运行：</p>
<p>后端： <a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/browser/server.html">https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/browser/server.html</a> </p>
<p>前端： <a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/browser/web.html">https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/browser/web.html</a> </p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%90%8E%E7%AB%AF%E8%AF%B4%E6%98%8E/" data-id="ckqma5ns600190wu71vxhhykj" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-区块中的交易和回执代码分析" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E5%8C%BA%E5%9D%97%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E5%92%8C%E5%9B%9E%E6%89%A7%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E5%8C%BA%E5%9D%97%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E5%92%8C%E5%9B%9E%E6%89%A7%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" class="article-date"><time datetime="2021-07-02T11:06:38.798Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>core/types中封装了一系列的类型和对这些类型应用的基本方法，本篇分几个模块探索有关的数据结构和基本的方法，并对重要的方法进行解析。</p>
<h6 id="1-交易"><a href="#1-交易" class="headerlink" title="1.交易"></a>1.交易</h6><p><strong>定义（黄皮书）</strong>：</p>
<p>交易**.** 交易（符号，<em>T</em>）是个单一的加密学签名的指令，通常由以太坊系统之外的操作者创建。我们假设外部的操作者是人，软件工具则用于构建和散播 1。这里的交易有两种类型：一种表现为消息调用，另一种则通过代码创建新的账户（称为“合约创建”）。这两种类型的交易都有一些共同的字段：</p>
<p><strong>nonce:</strong> 由交易发送者发出的的交易的数量，由 <em>T</em>n 表示。</p>
<p><strong>gasPrice:</strong> 为执行这个交易所需要进行的计算步骤消耗的每单位 <em>gas</em> 的价格，以 Wei 为单位，由 <em>T</em>p 表示。</p>
<p><strong>gasLimit:</strong> 用于执行这个交易的最大 gas 数量。这个值须在交易开始前设置，且设定后不能再增加，由<em>T</em>g 表示。</p>
<p><strong>to:</strong> 160 位的消息调用接收者地址；对与合约创建交易，用 ∅ 表示 B0 的唯一成员。此字段由 <em>T</em>t 表示<strong>value:</strong> 转移到接收者账户的 Wei 的数量；对于合约创建，则代表给新建合约地址的初始捐款。由 <em>T</em>v表示。</p>
<p><strong>v, r, s:</strong> 与交易签名相符的若干数值，用于确定交易的发送者，由 <em>T</em>w，<em>T</em>r 和 <em>T</em>s 表示。详见附录 F。此外，合约创建还包含以下字段:</p>
<p><strong>init:</strong> 一个不限制大小的字节数组，用来指定账户初始化程序的 EVM 代码，由 <em>T</em><strong>i</strong> 表示。<strong>init</strong>是 EVM 代码片段；它将返回 <strong>body</strong>，这是这个账户每次接收到消息调用时会执行的代码（通过一个交易或者代码的内部执行）。<strong>init</strong> 代码仅会在合约创建时被执行一次，然后就会被丢弃。与此相对，一个消息调用交易包括:<strong>data:</strong> 一个不限制大小的字节数组，用来指定消息调用的输入数据，由 <em>T</em><strong>d</strong> 表示。</p>
<p><strong>与交易有关的代码：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//交易的定义：包含了txdata和交易哈希，size,from，我猜想之所以要和txdata区分开是为取哈希的时候，hash的定义不包含在主交易结构里。</span></span><br><span class="line"><span class="keyword">type</span> Transaction <span class="keyword">struct</span> &#123;</span><br><span class="line">	data txdata</span><br><span class="line">	<span class="comment">// caches</span></span><br><span class="line">	hash atomic.Value</span><br><span class="line">	size atomic.Value</span><br><span class="line">	from atomic.Value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//txdata是交易的主要内容，和黄皮书上的定义基本吻合</span></span><br><span class="line"><span class="keyword">type</span> txdata <span class="keyword">struct</span> &#123;</span><br><span class="line">	AccountNonce <span class="keyword">uint64</span>          <span class="string">`json:&quot;nonce&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line">	Price        *big.Int        <span class="string">`json:&quot;gasPrice&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	GasLimit     <span class="keyword">uint64</span>          <span class="string">`json:&quot;gas&quot;      gencodec:&quot;required&quot;`</span></span><br><span class="line">	Recipient    *common.Address <span class="string">`json:&quot;to&quot;       rlp:&quot;nil&quot;`</span> <span class="comment">// nil means contract creation</span></span><br><span class="line">	Amount       *big.Int        <span class="string">`json:&quot;value&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line">	Payload      []<span class="keyword">byte</span>          <span class="string">`json:&quot;input&quot;    gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Signature values</span></span><br><span class="line">	V *big.Int <span class="string">`json:&quot;v&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	R *big.Int <span class="string">`json:&quot;r&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	S *big.Int <span class="string">`json:&quot;s&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// This is only used when marshaling to JSON.</span></span><br><span class="line">	Hash *common.Hash <span class="string">`json:&quot;hash&quot; rlp:&quot;-&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//json解析</span></span><br><span class="line"><span class="keyword">type</span> txdataMarshaling <span class="keyword">struct</span> &#123;</span><br><span class="line">	AccountNonce hexutil.Uint64</span><br><span class="line">	Price        *hexutil.Big</span><br><span class="line">	GasLimit     hexutil.Uint64</span><br><span class="line">	Amount       *hexutil.Big</span><br><span class="line">	Payload      hexutil.Bytes</span><br><span class="line">	V            *hexutil.Big</span><br><span class="line">	R            *hexutil.Big</span><br><span class="line">	S            *hexutil.Big</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新建交易：封装data，先不管hash,size,from的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTransaction</span><span class="params">(nonce <span class="keyword">uint64</span>, to common.Address, amount *big.Int, gasLimit <span class="keyword">uint64</span>, gasPrice *big.Int, data []<span class="keyword">byte</span>)</span> *<span class="title">Transaction</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> newTransaction(nonce, &amp;to, amount, gasLimit, gasPrice, data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newTransaction</span><span class="params">(nonce <span class="keyword">uint64</span>, to *common.Address, amount *big.Int, gasLimit <span class="keyword">uint64</span>, gasPrice *big.Int, data []<span class="keyword">byte</span>)</span> *<span class="title">Transaction</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(data) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		data = common.CopyBytes(data)</span><br><span class="line">	&#125;</span><br><span class="line">	d := txdata&#123;</span><br><span class="line">		AccountNonce: nonce,</span><br><span class="line">		Recipient:    to,</span><br><span class="line">		Payload:      data,</span><br><span class="line">		Amount:       <span class="built_in">new</span>(big.Int),</span><br><span class="line">		GasLimit:     gasLimit,</span><br><span class="line">		Price:        <span class="built_in">new</span>(big.Int),</span><br><span class="line">		V:            <span class="built_in">new</span>(big.Int),</span><br><span class="line">		R:            <span class="built_in">new</span>(big.Int),</span><br><span class="line">		S:            <span class="built_in">new</span>(big.Int),</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> amount != <span class="literal">nil</span> &#123;</span><br><span class="line">		d.Amount.Set(amount)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> gasPrice != <span class="literal">nil</span> &#123;</span><br><span class="line">		d.Price.Set(gasPrice)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;Transaction&#123;data: d&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//交易编码和解码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">EncodeRLP</span><span class="params">(w io.Writer)</span> <span class="title">error</span></span> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">DecodeRLP</span><span class="params">(s *rlp.Stream)</span> <span class="title">error</span></span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//解析为/解析json格式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">MarshalJSON</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">UnmarshalJSON</span><span class="params">(input []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//获取交易信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">Data</span><span class="params">()</span> []<span class="title">byte</span></span>       &#123; <span class="keyword">return</span> common.CopyBytes(tx.data.Payload) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">Gas</span><span class="params">()</span> <span class="title">uint64</span></span>        &#123; <span class="keyword">return</span> tx.data.GasLimit &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">GasPrice</span><span class="params">()</span> *<span class="title">big</span>.<span class="title">Int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">new</span>(big.Int).Set(tx.data.Price) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">Value</span><span class="params">()</span> *<span class="title">big</span>.<span class="title">Int</span></span>    &#123; <span class="keyword">return</span> <span class="built_in">new</span>(big.Int).Set(tx.data.Amount) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">Nonce</span><span class="params">()</span> <span class="title">uint64</span></span>      &#123; <span class="keyword">return</span> tx.data.AccountNonce &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tx *Transaction)</span> <span class="title">CheckNonce</span><span class="params">()</span> <span class="title">bool</span></span>   &#123; <span class="keyword">return</span> <span class="literal">true</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="2-收据"><a href="#2-收据" class="headerlink" title="2.收据"></a>2.收据</h6><p><strong>定义（黄皮书）</strong>：</p>
<p>为了能使交易信息对零知识证明、索引和搜索都是有用的，我们将每个交易执行过程中的一些特定信息编码为交易收据。我们以 <em>B</em><strong>R</strong>[<em>i</em>] 表示第 <em>i</em> 个交易的收据，并把收据信息保存在一个以索引为键的树（index-keyedtrie）中，树的根节点用 <em>H</em>e 保存到区块头中。交易收据 <em>R</em> 是一个包含四个条目的元组：包含交易收据的区块中当交易发生后的累积 gas 使用量 <em>R</em>u；交易过程中创建的日志集合 <em>R</em>l；由这些日志信息所构成的 Bloom 过滤器 <em>R</em>b 和交易的状态代码 <em>R</em>z。</p>
<p><strong>收据定义代码：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Receipt <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Consensus fields: These fields are defined by the Yellow Paper</span></span><br><span class="line">	PostState         []<span class="keyword">byte</span> <span class="string">`json:&quot;root&quot;`</span></span><br><span class="line">	Status            <span class="keyword">uint64</span> <span class="string">`json:&quot;status&quot;`</span></span><br><span class="line">	CumulativeGasUsed <span class="keyword">uint64</span> <span class="string">`json:&quot;cumulativeGasUsed&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	Bloom             Bloom  <span class="string">`json:&quot;logsBloom&quot;         gencodec:&quot;required&quot;`</span></span><br><span class="line">	Logs              []*Log <span class="string">`json:&quot;logs&quot;              gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Implementation fields: These fields are added by geth when processing a transaction.</span></span><br><span class="line">	<span class="comment">// They are stored in the chain database.</span></span><br><span class="line">	TxHash          common.Hash    <span class="string">`json:&quot;transactionHash&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	ContractAddress common.Address <span class="string">`json:&quot;contractAddress&quot;`</span></span><br><span class="line">	GasUsed         <span class="keyword">uint64</span>         <span class="string">`json:&quot;gasUsed&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Inclusion information: These fields provide information about the inclusion of the</span></span><br><span class="line">	<span class="comment">// transaction corresponding to this receipt.</span></span><br><span class="line">	BlockHash        common.Hash <span class="string">`json:&quot;blockHash,omitempty&quot;`</span></span><br><span class="line">	BlockNumber      *big.Int    <span class="string">`json:&quot;blockNumber,omitempty&quot;`</span></span><br><span class="line">	TransactionIndex <span class="keyword">uint</span>        <span class="string">`json:&quot;transactionIndex&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="区块"><a href="#区块" class="headerlink" title="区块"></a>区块</h6><p><strong>定义（黄皮书）</strong>：区块**.** 在以太坊中，区块是由以下部分组成的：一些相关信息片段组成的集合（称为 block <em>header</em>，即区块头）；组成区块的交易 <strong>T</strong> 和 其它一些区块头 <strong>U</strong> （这是一些父区块与当前区块的爷爷辈区块相同的区块，这样的区块称为<em>ommers</em>）。</p>
<p><strong>区块代码定义</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Header <span class="keyword">struct</span> &#123;</span><br><span class="line">	ParentHash  common.Hash    <span class="string">`json:&quot;parentHash&quot;       gencodec:&quot;required&quot;`</span></span><br><span class="line">	UncleHash   common.Hash    <span class="string">`json:&quot;sha3Uncles&quot;       gencodec:&quot;required&quot;`</span></span><br><span class="line">	Coinbase    common.Address <span class="string">`json:&quot;miner&quot;            gencodec:&quot;required&quot;`</span></span><br><span class="line">	Root        common.Hash    <span class="string">`json:&quot;stateRoot&quot;        gencodec:&quot;required&quot;`</span></span><br><span class="line">	TxHash      common.Hash    <span class="string">`json:&quot;transactionsRoot&quot; gencodec:&quot;required&quot;`</span></span><br><span class="line">	ReceiptHash common.Hash    <span class="string">`json:&quot;receiptsRoot&quot;     gencodec:&quot;required&quot;`</span></span><br><span class="line">	Bloom       Bloom          <span class="string">`json:&quot;logsBloom&quot;        gencodec:&quot;required&quot;`</span></span><br><span class="line">	Difficulty  *big.Int       <span class="string">`json:&quot;difficulty&quot;       gencodec:&quot;required&quot;`</span></span><br><span class="line">	Number      *big.Int       <span class="string">`json:&quot;number&quot;           gencodec:&quot;required&quot;`</span></span><br><span class="line">	GasLimit    <span class="keyword">uint64</span>         <span class="string">`json:&quot;gasLimit&quot;         gencodec:&quot;required&quot;`</span></span><br><span class="line">	GasUsed     <span class="keyword">uint64</span>         <span class="string">`json:&quot;gasUsed&quot;          gencodec:&quot;required&quot;`</span></span><br><span class="line">	Time        <span class="keyword">uint64</span>         <span class="string">`json:&quot;timestamp&quot;        gencodec:&quot;required&quot;`</span></span><br><span class="line">	Extra       []<span class="keyword">byte</span>         <span class="string">`json:&quot;extraData&quot;        gencodec:&quot;required&quot;`</span></span><br><span class="line">	MixDigest   common.Hash    <span class="string">`json:&quot;mixHash&quot;`</span></span><br><span class="line">	Nonce       BlockNonce     <span class="string">`json:&quot;nonce&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line">	header       *Header</span><br><span class="line">	uncles       []*Header</span><br><span class="line">	transactions Transactions</span><br><span class="line"></span><br><span class="line">	<span class="comment">// caches</span></span><br><span class="line">	hash atomic.Value</span><br><span class="line">	size atomic.Value</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Td is used by package core to store the total difficulty</span></span><br><span class="line">	<span class="comment">// of the chain up to and including the block.</span></span><br><span class="line">	td *big.Int</span><br><span class="line"></span><br><span class="line">	<span class="comment">// These fields are used by package eth to track</span></span><br><span class="line">	<span class="comment">// inter-peer block relay.</span></span><br><span class="line">	ReceivedAt   time.Time</span><br><span class="line">	ReceivedFrom <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Body <span class="keyword">struct</span> &#123;</span><br><span class="line">	Transactions []*Transaction</span><br><span class="line">	Uncles       []*Header</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新区块的创建：这个新区块的创建过程比较重要，参数有四个：header;txs;uncles;receipts，返回一个新的区块，状态树的根哈希root不在这里声明。下面在代码中加入一些注释和理解。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBlock</span><span class="params">(header *Header, txs []*Transaction, uncles []*Header, receipts []*Receipt)</span> *<span class="title">Block</span></span> &#123;</span><br><span class="line">	b := &amp;Block&#123;header: CopyHeader(header), td: <span class="built_in">new</span>(big.Int)&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> panic if len(txs) != len(receipts)先是检查交易的数量和收据的数量是否完整</span></span><br><span class="line">    <span class="comment">//检查如果交易量是0，则交易树的跟哈希是空，若不是零，调用DeriveSha来对这些交易构建tire树并取跟哈希，最后还把这些交易复制到区块中。</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(txs) == <span class="number">0</span> &#123;</span><br><span class="line">		b.header.TxHash = EmptyRootHash</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		b.header.TxHash = DeriveSha(Transactions(txs))</span><br><span class="line">		b.transactions = <span class="built_in">make</span>(Transactions, <span class="built_in">len</span>(txs))</span><br><span class="line">		<span class="built_in">copy</span>(b.transactions, txs)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//和构建交易树类似，构建收据树</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(receipts) == <span class="number">0</span> &#123;</span><br><span class="line">		b.header.ReceiptHash = EmptyRootHash</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		b.header.ReceiptHash = DeriveSha(Receipts(receipts))</span><br><span class="line">		b.header.Bloom = CreateBloom(receipts)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//将叔块加入到区块当中</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(uncles) == <span class="number">0</span> &#123;</span><br><span class="line">		b.header.UncleHash = EmptyUncleHash</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		b.header.UncleHash = CalcUncleHash(uncles)</span><br><span class="line">		b.uncles = <span class="built_in">make</span>([]*Header, <span class="built_in">len</span>(uncles))</span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> uncles &#123;</span><br><span class="line">			b.uncles[i] = CopyHeader(uncles[i])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>涉及到的DeriveSha函数，用于构建MPT树。</p>
<p>在core/types/derive_sha.go中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DerivableList <span class="keyword">interface</span> &#123;</span><br><span class="line">	Len() <span class="keyword">int</span></span><br><span class="line">	GetRlp(i <span class="keyword">int</span>) []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DeriveSha</span><span class="params">(list DerivableList)</span> <span class="title">common</span>.<span class="title">Hash</span></span> &#123;</span><br><span class="line">	keybuf := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">	trie := <span class="built_in">new</span>(trie.Trie)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; list.Len(); i++ &#123;</span><br><span class="line">		keybuf.Reset()</span><br><span class="line">		rlp.Encode(keybuf, <span class="keyword">uint</span>(i))</span><br><span class="line">		trie.Update(keybuf.Bytes(), list.GetRlp(i))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> trie.Hash()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其流程是：先新建trie树，之后将输入的list遍历，将每个元素的（RLP编码-内容）键值对调用trie.Update函数更新trie树，直到遍历完。之后返回trie的根哈希。</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E5%8C%BA%E5%9D%97%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E5%92%8C%E5%9B%9E%E6%89%A7%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" data-id="ckqma5ns7001a0wu70oa8h7vl" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-几种通信简介" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E5%87%A0%E7%A7%8D%E9%80%9A%E4%BF%A1%E7%AE%80%E4%BB%8B/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E5%87%A0%E7%A7%8D%E9%80%9A%E4%BF%A1%E7%AE%80%E4%BB%8B/" class="article-date"><time datetime="2021-07-02T11:06:38.797Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="线程之间的通信inproc"><a href="#线程之间的通信inproc" class="headerlink" title="线程之间的通信inproc"></a>线程之间的通信inproc</h3><p><strong>一、为什么要线程通信？</strong></p>
<p>1.多个线程并发执行时, 在默认情况下CPU是<strong>随机切换线程</strong>的，当我们需要多个线程来<strong>共同完成</strong>一件任务，</p>
<p>　　 并且我们希望他们<strong>有规律</strong>的执行, 那么多线程之间需要一些<strong>协调通信</strong>，以此来帮我们达到<strong>多线程共同操作一份数据</strong>。</p>
<p>2.当然如果我们没有使用线程通信来使用多线程共同操作同一份数据的话，虽然可以实现，</p>
<p>　　但是在很大程度会造成多线程之间对同一共享变量的争夺，那样的话势必为造成很多错误和损失！</p>
<p>3.所以，我们才引出了线程之间的通信，<code>多线程之间的通信能够避免对同一共享变量的争夺。</code> </p>
<p><strong>二、什么是线程通信？</strong> </p>
<p>多个线程在处理同一个资源，并且任务不同时，需要线程通信来帮助解决线程之间对同一个变量的使用或操作。</p>
<p>就是多个线程在操作同一份数据时， 避免对同一共享变量的争夺</p>
<p>于是我们引出了等待唤醒机制：（wait()、notify()）</p>
<p>就是在一个线程进行了规定操作后，就进入等待状态（wait）， 等待其他线程执行完他们的指定代码过后 再将其唤醒（notify）；</p>
<h6 id="（1）WAIT-方法："><a href="#（1）WAIT-方法：" class="headerlink" title="（1）WAIT()方法："></a>（1）WAIT()方法：</h6><p>在其他线程调用此对象的 notify() 方法或 notifyAll() 方法前，<strong>导致当前线程等待</strong>。</p>
<p>线程调用wait()方法，<strong>释放</strong>它对锁的拥有权，然后<strong>等待另外的线程来通知它</strong>（通知的方式是notify()或者notifyAll()方法），这样它才能重新获得锁的拥有权和恢复执行。</p>
<p>要确保调用wait()方法的时候<strong>拥有锁</strong>，即，wait()方法的调用必须放在<strong>synchronized</strong>方法或<strong>synchronized</strong>块中。</p>
<h6 id="（2）notif-方法："><a href="#（2）notif-方法：" class="headerlink" title="（2）notif()方法："></a><strong>（2）notif()方法：</strong></h6><p>notify()方法会唤醒一个等待当前对象的锁的线程。唤醒在此对象监视器上等待的单个线程。</p>
<h6 id="（3）notifAll-方法："><a href="#（3）notifAll-方法：" class="headerlink" title="（3）notifAll()方法："></a>（3）notifAll()方法：</h6><p>notifyAll（）方法会唤醒在此对象监视器上等待的所有线程。<br> 如果多个线程在等待，它们中的一个将会选择被唤醒。这种选择是随意的，和具体实现有关。（线程等待一个对象的锁是由于调用了wait方法中的一个）</p>
<p>notify()方法应该是被拥有对象的锁的线程所调用。</p>
<p>一般而言,在一个应用程序中（即进程），一个线程往往不是孤立存在的，常常需要和其它线程通信，以执行特定的任务。如主线程和次线程，次线程与次线程，工作线程和用户界面线程等。这样,线程与线程间必定有一个信息传递的渠道。这种线程间的通信不但是难以避免的，而且在多线程编程中也是复杂和频繁的。</p>
<h3 id="进程间通信ipc"><a href="#进程间通信ipc" class="headerlink" title="进程间通信ipc"></a><strong>进程间通信</strong>ipc</h3><p>又称IPC(Inter-Process Communication),指多个进程之间相互通信，交换信息的方法。根据进程通信时信息量大小的不同,可以将进程通信划分为两大类型:<br> 1、低级通信,控制信息的通信(主要用于进程之间的同步,互斥,终止和挂起等等控制信息的传递)<br> 2、高级通信,大批数据信息的通信(主要用于进程间数据块数据的交换和共享,常见的高级通信有管道,消息队列,共享内存等).</p>
<ul>
<li><a href="">管道( pipe )</a>：管道是一种<a href="">半双工的通信方式</a>，数据只能单向流动，而且<a href="">只能在具有亲缘关系的进程间使用</a>。进程的亲缘关系通常是指父子进程关系。</li>
<li><a href="">有名管道 (named pipe) </a>： 有名管道也是半双工的通信方式，但是它<a href="">允许无亲缘关系进程间的通信</a>。</li>
<li><a href="">信号量( semophore )</a> ： 信号量是一个计数器，可以用来控制多个进程对共享资源的访问。<a href="">不是用于交换大批数据,而用于多线程之间的同步.常作为一种锁机制,防止某进程在访问资源时其它进程也访问该资源</a>。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。</li>
<li><a href="">消息队列( message queue ) </a>： 消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列<a href="">克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点</a>。</li>
<li><a href="">信号 ( signal ) </a>： 信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。</li>
<li>[共享内存( shared memory )] ：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是<a href="">最快的 IPC 方式</a>，它是针对其他进程间通信方式运行效率低而专门设计的。<a href="">它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信</a>。</li>
<li><a href="">套接字( socket ) </a>： 套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。</li>
</ul>
<h3 id="HTTP（）"><a href="#HTTP（）" class="headerlink" title="HTTP（）"></a>HTTP（）</h3><h3 id="WebSocket-ws"><a href="#WebSocket-ws" class="headerlink" title="WebSocket(ws)"></a>WebSocket(ws)</h3><p><strong>WebSocket</strong>是一种在单个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/TCP">TCP</a>连接上进行<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%85%A8%E5%8F%8C%E5%B7%A5">全双工</a>通信的协议。WebSocket通信协议于2011年被<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IETF">IETF</a>定为标准RFC 6455，并由RFC7936补充规范。WebSocket <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/API">API</a>也被<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/W3C">W3C</a>定为标准。</p>
<p>WebSocket使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在WebSocket API中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
<p>优点：</p>
<ul>
<li>较少的控制开销。在连接创建后，服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。在不包含扩展的情况下，对于服务器到客户端的内容，此头部大小只有2至10<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%97%E8%8A%82">字节</a>（和数据包长度有关）；对于客户端到服务器的内容，此头部还需要加上额外的4字节的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A9%E7%A0%81">掩码</a>。相对于HTTP请求每次都要携带完整的头部，此项开销显著减少了。</li>
<li>更强的实时性。由于协议是全双工的，所以服务器可以随时主动给客户端下发数据。相对于HTTP请求需要等待客户端发起请求服务端才能响应，延迟明显更少；即使是和Comet等类似的长轮询比较，其也能在短时间内更多次地传递数据。</li>
<li>保持连接状态。与HTTP不同的是，Websocket需要先创建连接，这就使得其成为一种有状态的协议，之后通信时可以省略部分状态信息。而HTTP请求可能需要在每个请求都携带状态信息（如身份认证等）。</li>
<li>更好的二进制支持。Websocket定义了<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BA%8C%E8%BF%9B%E5%88%B6">二进制</a>帧，相对HTTP，可以更轻松地处理二进制内容。</li>
<li>可以支持扩展。Websocket定义了扩展，用户可以扩展协议、实现部分自定义的子协议。如部分浏览器支持<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8E%8B%E7%BC%A9">压缩</a>等。</li>
<li>更好的压缩效果。相对于<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/HTTP%E5%8E%8B%E7%BC%A9">HTTP压缩</a>，Websocket在适当的扩展支持下，可以沿用之前内容的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%B8%8A%E4%B8%8B%E6%96%87">上下文</a>，在传递类似的数据时，可以显著地提高压缩率。</li>
</ul>
<p>WebSocket 是独立的、创建在 TCP 上的协议。</p>
<p>Websocket 通过<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/HTTP">HTTP</a>/1.1 协议的101状态码进行握手。</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E5%87%A0%E7%A7%8D%E9%80%9A%E4%BF%A1%E7%AE%80%E4%BB%8B/" data-id="ckqma5ns500170wu7caos9o14" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-前端入门基础" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/" class="article-date"><time datetime="2021-07-02T11:06:38.797Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>浏览器和服务器通过几次握手后，得到服务器传回给浏览器的代码，浏览器接收到代码后进行解析，之后进行三大步骤：DOM构造、布局以及绘制页面，最终变为人人可见的网页</p>
<h4 id="1-DOM构造"><a href="#1-DOM构造" class="headerlink" title="1.DOM构造"></a>1.DOM构造</h4><p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%801.png"></p>
<p>浏览器首先将收到的html代码通过html解析器构建为一颗DOM树</p>
<p>接着将接收到的CSS代码通过css解析器构建出样式表规则，将这些规则分别放到对应的DOM树节点上。</p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%802.png"></p>
<p>得到一颗带有样式属性的DOM树</p>
<h4 id="2-布局"><a href="#2-布局" class="headerlink" title="2.布局"></a>2.布局</h4><p>浏览器按从上到下，从左到右的顺序，读取DOM树的文档节点，顺序存放到一条虚拟的传送带上，</p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%803.png"></p>
<p>嵌套放（可以嵌套的层级是没有限制的），形成文档流，文档流排完之后开始获取计算节点的坐标和大小等CSS属性，作为盒子的包装说明，之后将盒子在页面上一一摆放，将节点布局到页面。</p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%804.png"></p>
<h4 id="3-绘制页面"><a href="#3-绘制页面" class="headerlink" title="3.绘制页面"></a>3.绘制页面</h4><p>最后将布局到页面上的内容绘制出来</p>
<p>举例：</p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%805.png"></p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%806.png"></p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%807.png"></p>
<p><img src="./picture/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%808.png"></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/" data-id="ckqma5ns500180wu7bcrecrty" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-以太坊账户" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%B4%A6%E6%88%B7/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%B4%A6%E6%88%B7/" class="article-date"><time datetime="2021-07-02T11:06:38.796Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>基于账户的模型：account-based ledger</p>
<p>避免双花攻击/双重攻击：nonce机制，指交易的次数</p>
<p>两种账户：</p>
<p>externally owned account : 外部账户</p>
<p>外部账户状态有：</p>
<p>balance</p>
<p>nonce</p>
<p>smart contract account : 合约账户</p>
<p>合约账户不能主动发起交易；但可以调用其他合约</p>
<p>合约账户状态还有：</p>
<p>code </p>
<p>storage  </p>
<h6 id="黄皮书中的说法："><a href="#黄皮书中的说法：" class="headerlink" title="黄皮书中的说法："></a>黄皮书中的说法：</h6><p>账户状态 <strong>σ</strong>[<em>a</em>] 包含以下四个字： </p>
<p><strong>nonce:</strong> 这个值等于由此账户地址发出的交易数量，或者由这个账户所创建的合约数量（当这个账户有关联代码时）。<strong>σ</strong>[<em>a</em>]<em>n</em> 即表示状态 <strong>σ</strong> 中的地址 <em>a</em> 的nonce 值。</p>
<p><strong>balance</strong>: <strong>σ</strong>[<em>a</em>]b，表示这个账户地址拥有多少 Wei（即账户余额，译者注）。</p>
<p><strong>storageRoot:</strong> 保存了账户的存储内容的 Merkle Patricia 树的根节点的 256 位哈希值，这个树中保存的是 256 位整数键值的 Keccak 256 位哈希值到256 位整数值的 RLP 编码的映射。这个哈希定义为 <strong>σ</strong>[<em>a</em>]<em>s</em>。</p>
<p><strong>codeHash</strong>: 这个账户的 EVM 代码哈希值——当这个地址接收到一个消息调用时，这些代码会被执行；它和其它字段不同，创建后不可更改。状态数据库中包含所有这样的代码片段哈希，以便后续使用。这个哈希可以定义为 <strong>σ</strong>[<em>a</em>]<em>c</em>，然后我们用 <strong>b</strong> 来表示代码，则有 KEC(<strong>b</strong>) = <strong>σ</strong>[<em>a</em>]<em>c</em>。</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%B4%A6%E6%88%B7/" data-id="ckqma5ns400150wu7gwaxdsnb" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-以太坊挖矿" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%8C%96%E7%9F%BF/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%8C%96%E7%9F%BF/" class="article-date"><time datetime="2021-07-02T11:06:38.795Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>memory hard mining puzzle</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%8C%96%E7%9F%BF/" data-id="ckqma5ns200130wu79t94g0cm" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  
    <article id="post-以太坊交易池（2）" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BA%A4%E6%98%93%E6%B1%A0%EF%BC%882%EF%BC%89/">(no title)</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BA%A4%E6%98%93%E6%B1%A0%EF%BC%882%EF%BC%89/" class="article-date"><time datetime="2021-07-02T11:06:38.795Z" itemprop="datePublished">2021-07-02</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="以太坊交易池构建"><a href="#以太坊交易池构建" class="headerlink" title="以太坊交易池构建"></a>以太坊交易池构建</h3><h4 id="初始化都做了哪些事情？"><a href="#初始化都做了哪些事情？" class="headerlink" title="初始化都做了哪些事情？"></a>初始化都做了哪些事情？</h4><h6 id="1-基础设置和通道创建"><a href="#1-基础设置和通道创建" class="headerlink" title="1.基础设置和通道创建"></a>1.基础设置和通道创建</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pool := &amp;TxPool&#123;</span><br><span class="line"><span class="comment">//基础设置 config，signer签名器，链配置等</span></span><br><span class="line">	config:          config,</span><br><span class="line">	chainconfig:     chainconfig,</span><br><span class="line">	chain:           chain,</span><br><span class="line">	signer:          types.NewEIP155Signer(chainconfig.ChainID),</span><br><span class="line"><span class="comment">//创建pending queue 和all交易列表	</span></span><br><span class="line">	pending:         <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]*txList),</span><br><span class="line">	queue:           <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]*txList),</span><br><span class="line">	beats:           <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]time.Time),</span><br><span class="line">	all:             newTxLookup(),</span><br><span class="line"><span class="comment">//创建各种通道	</span></span><br><span class="line">	chainHeadCh:     <span class="built_in">make</span>(<span class="keyword">chan</span> ChainHeadEvent, chainHeadChanSize),</span><br><span class="line">	reqResetCh:      <span class="built_in">make</span>(<span class="keyword">chan</span> *txpoolResetRequest),</span><br><span class="line">	reqPromoteCh:    <span class="built_in">make</span>(<span class="keyword">chan</span> *accountSet),</span><br><span class="line">	queueTxEventCh:  <span class="built_in">make</span>(<span class="keyword">chan</span> *types.Transaction),</span><br><span class="line">	reorgDoneCh:     <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;),</span><br><span class="line">	reorgShutdownCh: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;),</span><br><span class="line"><span class="comment">//gasPrice设置	</span></span><br><span class="line">	gasPrice:        <span class="built_in">new</span>(big.Int).SetUint64(config.PriceLimit),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="2-检查本地交易-将本地地址加载入交易池，按价格排序"><a href="#2-检查本地交易-将本地地址加载入交易池，按价格排序" class="headerlink" title="2.检查本地交易 将本地地址加载入交易池，按价格排序"></a>2.检查本地交易 将本地地址加载入交易池，按价格排序</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pool.locals = newAccountSet(pool.signer)</span><br><span class="line"><span class="keyword">for</span> _, addr := <span class="keyword">range</span> config.Locals &#123;</span><br><span class="line">	log.Info(<span class="string">&quot;Setting new local account&quot;</span>, <span class="string">&quot;address&quot;</span>, addr)</span><br><span class="line">	pool.locals.add(addr)</span><br><span class="line">&#125;</span><br><span class="line">pool.priced = newTxPricedList(pool.all)</span><br></pre></td></tr></table></figure>

<h6 id="3-进行一次重置操作"><a href="#3-进行一次重置操作" class="headerlink" title="3.进行一次重置操作"></a>3.进行一次重置操作</h6><p><code>pool.reset(nil, chain.CurrentBlock().Header())</code></p>
<h6 id="4-开启重置轮询"><a href="#4-开启重置轮询" class="headerlink" title="4.开启重置轮询"></a>4.开启重置轮询</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> pool.scheduleReorgLoop()</span><br></pre></td></tr></table></figure>

<h6 id="5-加载日志"><a href="#5-加载日志" class="headerlink" title="5.加载日志"></a>5.加载日志</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If local transactions and journaling is enabled, load from disk</span></span><br><span class="line"><span class="keyword">if</span> !config.NoLocals &amp;&amp; config.Journal != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">	pool.journal = newTxJournal(config.Journal)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := pool.journal.load(pool.AddLocals); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Warn(<span class="string">&quot;Failed to load transaction journal&quot;</span>, <span class="string">&quot;err&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := pool.journal.rotate(pool.local()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Warn(<span class="string">&quot;Failed to rotate transaction journal&quot;</span>, <span class="string">&quot;err&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="6-从区块链订阅事件并启动主事件循环。"><a href="#6-从区块链订阅事件并启动主事件循环。" class="headerlink" title="6.从区块链订阅事件并启动主事件循环。"></a>6.从区块链订阅事件并启动主事件循环。</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pool.chainHeadSub = pool.chain.SubscribeChainHeadEvent(pool.chainHeadCh)</span><br><span class="line">pool.wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> pool.loop()</span><br></pre></td></tr></table></figure>

<h3 id="轮询事件"><a href="#轮询事件" class="headerlink" title="轮询事件"></a>轮询事件</h3><h5 id="主事件：不间断监听以下通道的事件并作出回应"><a href="#主事件：不间断监听以下通道的事件并作出回应" class="headerlink" title="主事件：不间断监听以下通道的事件并作出回应"></a>主事件：不间断监听以下通道的事件并作出回应</h5><p>pool.chainHeadCh</p>
<p>pool.chainHeadSub.Err()</p>
<p>report.C</p>
<p>evict.C</p>
<p>journal.C</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loop is the transaction pool&#x27;s main event loop, waiting for and reacting to</span></span><br><span class="line"><span class="comment">// outside blockchain events as well as for various reporting and transaction</span></span><br><span class="line"><span class="comment">// eviction events.循环是事务池的主事件循环，它等待和响应外部区块链事件以及各种报告和事务逐出事件。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pool *TxPool)</span> <span class="title">loop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> pool.wg.Done()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		prevPending, prevQueued, prevStales <span class="keyword">int</span></span><br><span class="line">		<span class="comment">// Start the stats reporting and transaction eviction tickers</span></span><br><span class="line">		report  = time.NewTicker(statsReportInterval)</span><br><span class="line">		evict   = time.NewTicker(evictionInterval)</span><br><span class="line">		journal = time.NewTicker(pool.config.Rejournal)</span><br><span class="line">		<span class="comment">// Track the previous head headers for transaction reorgs</span></span><br><span class="line">		head = pool.chain.CurrentBlock()</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">defer</span> report.Stop()</span><br><span class="line">	<span class="keyword">defer</span> evict.Stop()</span><br><span class="line">	<span class="keyword">defer</span> journal.Stop()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="comment">// Handle ChainHeadEvent</span></span><br><span class="line">		<span class="keyword">case</span> ev := &lt;-pool.chainHeadCh:</span><br><span class="line">			<span class="keyword">if</span> ev.Block != <span class="literal">nil</span> &#123;</span><br><span class="line">				pool.requestReset(head.Header(), ev.Block.Header())</span><br><span class="line">				head = ev.Block</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// System shutdown.</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-pool.chainHeadSub.Err():</span><br><span class="line">			<span class="built_in">close</span>(pool.reorgShutdownCh)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Handle stats reporting ticks</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-report.C:</span><br><span class="line">			pool.mu.RLock()</span><br><span class="line">			pending, queued := pool.stats()</span><br><span class="line">			stales := pool.priced.stales</span><br><span class="line">			pool.mu.RUnlock()</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> pending != prevPending || queued != prevQueued || stales != prevStales &#123;</span><br><span class="line">				log.Debug(<span class="string">&quot;Transaction pool status report&quot;</span>, <span class="string">&quot;executable&quot;</span>, pending, <span class="string">&quot;queued&quot;</span>, queued, <span class="string">&quot;stales&quot;</span>, stales)</span><br><span class="line">				prevPending, prevQueued, prevStales = pending, queued, stales</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Handle inactive account transaction eviction</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-evict.C:</span><br><span class="line">			pool.mu.Lock()</span><br><span class="line">			<span class="keyword">for</span> addr := <span class="keyword">range</span> pool.queue &#123;</span><br><span class="line">				<span class="comment">// Skip local transactions from the eviction mechanism</span></span><br><span class="line">				<span class="keyword">if</span> pool.locals.contains(addr) &#123;</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// Any non-locals old enough should be removed</span></span><br><span class="line">				<span class="keyword">if</span> time.Since(pool.beats[addr]) &gt; pool.config.Lifetime &#123;</span><br><span class="line">					<span class="keyword">for</span> _, tx := <span class="keyword">range</span> pool.queue[addr].Flatten() &#123;</span><br><span class="line">						pool.removeTx(tx.Hash(), <span class="literal">true</span>)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			pool.mu.Unlock()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Handle local transaction journal rotation</span></span><br><span class="line">		<span class="keyword">case</span> &lt;-journal.C:</span><br><span class="line">			<span class="keyword">if</span> pool.journal != <span class="literal">nil</span> &#123;</span><br><span class="line">				pool.mu.Lock()</span><br><span class="line">				<span class="keyword">if</span> err := pool.journal.rotate(pool.local()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">					log.Warn(<span class="string">&quot;Failed to rotate local tx journal&quot;</span>, <span class="string">&quot;err&quot;</span>, err)</span><br><span class="line">				&#125;</span><br><span class="line">				pool.mu.Unlock()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="重置事件：scheduleReorgLoop调度reset和promoteExecutables的运行。上面的代码不应该直接调用这些方法，而是使用requestReset和requestPromoteExecutables请求它们运行。"><a href="#重置事件：scheduleReorgLoop调度reset和promoteExecutables的运行。上面的代码不应该直接调用这些方法，而是使用requestReset和requestPromoteExecutables请求它们运行。" class="headerlink" title="重置事件：scheduleReorgLoop调度reset和promoteExecutables的运行。上面的代码不应该直接调用这些方法，而是使用requestReset和requestPromoteExecutables请求它们运行。"></a>重置事件：scheduleReorgLoop调度reset和promoteExecutables的运行。上面的代码不应该直接调用这些方法，而是使用requestReset和requestPromoteExecutables请求它们运行。</h5><p>从以下通道接收信号，每次接受任意信号开始新的循环</p>
<p>pool.reqResetCh</p>
<p>pool.reqPromoteCh</p>
<p>pool.queueTxEventCh</p>
<p>curDone</p>
<p>pool.reorgShutdownCh</p>
<p>每次循环判断：</p>
<p>1.接收到了curDone</p>
<p>2.接受到了pool.reqResetCh信号</p>
<p>便执行reset重置操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scheduleReorgLoop schedules runs of reset and promoteExecutables. Code above should not</span></span><br><span class="line"><span class="comment">// call those methods directly, but request them being run using requestReset and</span></span><br><span class="line"><span class="comment">// requestPromoteExecutables instead.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pool *TxPool)</span> <span class="title">scheduleReorgLoop</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> pool.wg.Done()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		curDone       <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125; <span class="comment">// non-nil while runReorg is active</span></span><br><span class="line">		nextDone      = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">		launchNextRun <span class="keyword">bool</span></span><br><span class="line">		reset         *txpoolResetRequest</span><br><span class="line">		dirtyAccounts *accountSet</span><br><span class="line">		queuedEvents  = <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]*txSortedMap)</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// Launch next background reorg if needed</span></span><br><span class="line">		<span class="keyword">if</span> curDone == <span class="literal">nil</span> &amp;&amp; launchNextRun &#123;</span><br><span class="line">			<span class="comment">// Run the background reorg and announcements</span></span><br><span class="line">			<span class="keyword">go</span> pool.runReorg(nextDone, reset, dirtyAccounts, queuedEvents)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Prepare everything for the next round of reorg</span></span><br><span class="line">			curDone, nextDone = nextDone, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">			launchNextRun = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">			reset, dirtyAccounts = <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">			queuedEvents = <span class="built_in">make</span>(<span class="keyword">map</span>[common.Address]*txSortedMap)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> req := &lt;-pool.reqResetCh:</span><br><span class="line">			<span class="comment">// Reset request: update head if request is already pending.</span></span><br><span class="line">			<span class="keyword">if</span> reset == <span class="literal">nil</span> &#123;</span><br><span class="line">				reset = req</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				reset.newHead = req.newHead</span><br><span class="line">			&#125;</span><br><span class="line">			launchNextRun = <span class="literal">true</span></span><br><span class="line">			pool.reorgDoneCh &lt;- nextDone</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> req := &lt;-pool.reqPromoteCh:</span><br><span class="line">			<span class="comment">// Promote request: update address set if request is already pending.</span></span><br><span class="line">			<span class="keyword">if</span> dirtyAccounts == <span class="literal">nil</span> &#123;</span><br><span class="line">				dirtyAccounts = req</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				dirtyAccounts.merge(req)</span><br><span class="line">			&#125;</span><br><span class="line">			launchNextRun = <span class="literal">true</span></span><br><span class="line">			pool.reorgDoneCh &lt;- nextDone</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> tx := &lt;-pool.queueTxEventCh:</span><br><span class="line">			<span class="comment">// Queue up the event, but don&#x27;t schedule a reorg. It&#x27;s up to the caller to</span></span><br><span class="line">			<span class="comment">// request one later if they want the events sent.</span></span><br><span class="line">			addr, _ := types.Sender(pool.signer, tx)</span><br><span class="line">			<span class="keyword">if</span> _, ok := queuedEvents[addr]; !ok &#123;</span><br><span class="line">				queuedEvents[addr] = newTxSortedMap()</span><br><span class="line">			&#125;</span><br><span class="line">			queuedEvents[addr].Put(tx)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> &lt;-curDone:</span><br><span class="line">			curDone = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> &lt;-pool.reorgShutdownCh:</span><br><span class="line">			<span class="comment">// Wait for current run to finish.</span></span><br><span class="line">			<span class="keyword">if</span> curDone != <span class="literal">nil</span> &#123;</span><br><span class="line">				&lt;-curDone</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">close</span>(nextDone)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="交易池重置"><a href="#交易池重置" class="headerlink" title="交易池重置"></a>交易池重置</h3><p>reset函数的执行流程：</p>
<p><img src="./picture/12.png"></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://yezzi.tech/2021/07/02/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BA%A4%E6%98%93%E6%B1%A0%EF%BC%882%EF%BC%89/" data-id="ckqma5ns300140wu78j481fqv" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
</article>



  


  <div id="page-nav">
    <nav><ul class="pagination"><li class="disabled"><span class="page-prev"><i class="fa fa-chevron-left"></i> Prev</a></li><li class="active"><span class="page-number">1</span></li><li><a class="page-number" href="/page/2/">2</a></li><li><a class="page-number" href="/page/3/">3</a></li><li><a class="page-number" href="/page/4/">4</a></li><li><a class="page-next" rel="next" href="/page/2/">Next <i class="fa fa-chevron-right"></i></a></li></ul></nav>
  </div>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p> Nice papers collected in the field of <em>AI</em>, <em>Apllied Cryptography</em> and <em>Blockchain</em>, records of some computer technologies, and personal thoughts.  If you are inteseted in my field, feel free to contact me. (Wechat: mzliu_xdu) </p>

</div>


  


  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list" itemprop="keywords"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/go/" rel="tag">go</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/golang/" rel="tag">golang</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/hyperledger-fabric/" rel="tag">hyperledger fabric</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/java/" rel="tag">java</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/paper-notes/" rel="tag">paper notes</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/" rel="tag">以太坊</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/go/" style="font-size: 20px;">go</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/hyperledger-fabric/" style="font-size: 20px;">hyperledger fabric</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/paper-notes/" style="font-size: 10px;">paper notes</a> <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/" style="font-size: 10px;">以太坊</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 10px;">区块链</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2021/07/">July 2021</a><span class="sidebar-module-list-count">28</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/07/">July 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/02/">February 2020</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/10/">October 2019</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/08/">August 2019</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2021/07/02/%E9%97%AE%E9%A2%98/">(no title)</a>
        </li>
      
        <li>
          <a href="/2021/07/02/%E7%8A%B6%E6%80%81%EF%BC%9B%E7%8A%B6%E6%80%81%E6%A0%91%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">(no title)</a>
        </li>
      
        <li>
          <a href="/2021/07/02/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/">(no title)</a>
        </li>
      
        <li>
          <a href="/2021/07/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%B5%8F%E8%A7%88%E5%99%A8%E5%90%8E%E7%AB%AF%E8%AF%B4%E6%98%8E/">(no title)</a>
        </li>
      
        <li>
          <a href="/2021/07/02/%E5%8C%BA%E5%9D%97%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E5%92%8C%E5%9B%9E%E6%89%A7%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">(no title)</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2021 Mingzhe Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>




<script src="/js/script.js"></script>


</body>
</html>
